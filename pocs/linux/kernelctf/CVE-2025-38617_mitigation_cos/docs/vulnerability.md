# Vulnerability

A race between packet_set_ring() and packet_notifier() allow the packet socket to hook to network interface and receive packet sent to that network interface while the ring buffer is configured. The received packet might found the old ring buffer that already be freed.

## Requirements to trigger the vulnerability:
- Capabilities: To trigger the vulnerability, `CAP_NET_RAW` capabilities are required.
- Kernel configuration: `CONFIG_PACKET` is required to trigger this vulnerability.
- Are user namespaces needed?: Yes. As this vulnerability requires `CAP_NET_RAW`, which are not usually given to the normal user, we used the unprivileged user namespace to achieve this capability.

## Commit which introduced the vulnerability
- This vulnerability was introduced in Linux-2.6.12-rc2, with commit [ce06b03e60fc1](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=ce06b03e60fc1)
- This commit add head drop fifo queue to the kernel.

## Commit which fixed the vulnerability
- This vulnerability was fixed with commit [01d3c8417b9c1b884a8a981a3b886da556512f36](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=01d3c8417b9c1b884a8a981a3b886da556512f36)

## Affected kernel versions
- Linux version 2.6.12 - 6.16 affects to this vulnerability

## Affected component, subsystem
- Packet socket
  
## Cause (UAF, BoF, race condition, double free, refcount overflow, etc)
- UAF