# Vulneribility
IORING_REGISTER_PBUF_RING can reuse an old struct io_buffer_list if it was created for legacy selected buffer and has been emptied. It violates the requirement that most of the field should stay stable after publish. Always reallocate it instead.

## Requirements to trigger the vulnerability
- Capabilities: NONE
- Kernel configuration: `CONFIG_IO_URING`
- User namespaces needed: No
  
## Commit which introduced the vulnerability
- [2fcabce2d7d34f69a888146dab15b36a917f09d4](https://web.git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2fcabce2d7d34f69a888146dab15b36a917f09d4)

## Commit which fixed the vulnerability
- Fixed in 6.6.79 with commit [146a185f6c05ee263db715f860620606303c4633](https://web.git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=146a185f6c05ee263db715f860620606303c4633)
- Fixed in 6.12.16 with commit [7d0dc28dae836caf7645fef62a10befc624dd17b](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=7d0dc28dae836caf7645fef62a10befc624dd17b)
- Fixed in 6.13.4 with commit [2a5febbef40ce968e295a7aeaa5d5cbd9e3e5ad4](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=2a5febbef40ce968e295a7aeaa5d5cbd9e3e5ad4)
- Fixed in 6.14-rc3 with commit [8802766324e1f5d414a81ac43365c20142e85603](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=8802766324e1f5d414a81ac43365c20142e85603)

## Affected kernel versions
- 6.6.0 - 6.6.79
- 6.12.0 - 6.12.16
- 6.13.0 - 6.13.4

## Affected component, subsystem
- io_uring

## Cause
- Race condition