- Requirements:
    - Capabilities: CAP_NET_ADMIN
    - Kernel configuration: CONFIG_NETFILTER=y, CONFIG_IP_SET=y, CONFIG_IP_SET_BITMAP_IP=y
    - User namespaces required: Yes
- Introduced by: https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit?id=72205fc68bd1
- Fixed by: https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=35f56c554eb1b56b77b3cf197a6b00922d49033d
- Affected Version: v2.6.39 - v6.12
- Affected Component: netfilter, ip_set
- URL: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-53141
- Cause: Missing Range Check, Out-Of-Bounds Write


In the `ipset` subsystem, `bitmap:ip` sets allow adding ranges of an entire CIDR
to the set via `tb[IPSET_ATTR_CIDR]` attribute (see `bitmap_ip_uadt()` in
`net/netfilter/ipset/ip_set_bitmap_ip.c`). This will essentially mask the given
first IP (`tb[IPSET_ATTR_IP]`) and add the subnet range to the bitmap. Before the
fix, the range checks of this were flawed because the resulting range was checked
based on the user provided IP instead of the masked one after applying the CIDR.

F.e., if the user set up a bitmap in the range `255.255.255.123, 255.255.255.255`,
and added elements for the `255.255.255.123/24` subnet, the kernel would mask the
initial IP to be `255.255.255.0` thus underflowing the first index by 123 causing
OOB writes.
