# define complier type
CC = gcc
# compile options setting
CFLAGS = -O2 -static -w
# library link & option setting
LDFLAGS = -lkeyutils

SUBDIRS = modules
clean_subdirs:
	@for dir in $(SUBDIRS); do \
		$(MAKE) -C $$dir clean; \
	done
	
exploit: exploit.c modules/helper.o modules/pipe.o modules/xattr.o modules/msg_msg.o modules/keyring.o 
	$(CC) $(CFLAGS) $^ -o $@ $(LIBS) $(INCLUDES) $(LDFLAGS) 

root: root.c
	$(CC) $(CFLAGS) $^ -o $@ $(LIBS) $(INCLUDES) $(LDFLAGS) 

all:
	$(MAKE) exploit

clean:
	$(MAKE) clean_subdirs
	rm -f *.o exploit