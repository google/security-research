# Vulneribility
 In function nft_map_catchall_deactivate, it checks if an elem in set->catchall_list can be deactivated by this:

```
if (!nft_set_elem_active(ext, genmask))
    continue;
```
but it should check like code in function  `nft_set_catchall_flush`:
```
if (!nft_set_elem_active(ext, genmask) ||
   nft_set_elem_mark_busy(ext))
    continue;
```
This makes it possible to call `nft_setelem_data_deactivate` twice for a elem in set->catchall_list.

I submitted the suggestion to security@kernel.org, but at that time, the `nft_set_elem_mark_busy` function had been removed in the latest kernel version. So the developers chose the fix in this [commit](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=90e5b3462efa37b8bba82d7c4e63683856e188af). Both methods can fix this vulnerability.

## Requirements to trigger the vulnerability
 - Capabilities:  `CAP_NET_ADMIN` capability is required.
 - Kernel configuration: `CONFIG_NETFILTER`, `CONFIG_NF_TABLES`
 - Are user namespaces needed?: Yes
  
## Commit which introduced the vulnerability
 - [commit a7384f3918756c193e3fcd7e3111fc4bd3686013](https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/commit/net/netfilter/nf_tables_api.c?id=a7384f3918756c193e3fcd7e3111fc4bd3686013)

## Commit which fixed the vulnerability
- [commit 90e5b3462efa37b8bba82d7c4e63683856e188af](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=90e5b3462efa37b8bba82d7c4e63683856e188af)

## Affected kernel versions
- 6.1.36 - 6.1.45

## Affected component, subsystem
- net/netfilter (nf_tables)

## Cause
- UAF

