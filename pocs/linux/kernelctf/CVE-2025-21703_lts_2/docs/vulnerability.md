# Vulneribility
qdisc_tree_reduce_backlog() notifies parent qdisc only if child qdisc becomes empty, therefore we need to reduce the backlog of the child qdisc before calling it. Otherwise it would miss the opportunity to call cops->qlen_notify(), in the case of DRR, it resulted in UAF since DRR uses ->qlen_notify() to maintain its active list.

## Requirements to trigger the vulnerability
- Capabilities: `CAP_NET_ADMIN`
- Kernel configuration: `CONFIG_NET_SCHED`, `CONFIG_NET_SCH_NETEM`
- User namespaces needed: Yes
  
## Commit which introduced the vulnerability
- [f8d4bc455047cf3903cd6f85f49978987dbb3027](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=f8d4bc455047cf3903cd6f85f49978987dbb3027)

## Commit which fixed the vulnerability
- Fixed in 6.6.78 with commit [1f8e3f4a4b8b90ad274dfbc66fc7d55cb582f4d5](https://web.git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1f8e3f4a4b8b90ad274dfbc66fc7d55cb582f4d5)
- Fixed in 6.12.14 with commit [6312555249082d6d8cc5321ff725df05482d8b83](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=6312555249082d6d8cc5321ff725df05482d8b83)
- Fixed in 6.13.3 with commit [839ecc583fa00fab785fde1c85a326743657fd32](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=839ecc583fa00fab785fde1c85a326743657fd32)

## Affected kernel versions
- 6.6.67 - 6.6.78
- 6.12.6 - 6.12.14
- 6.13.0 - 6.13.3

## Affected component, subsystem
- net/sched subsystem

## Cause
- Use-After-Free