CC = gcc
CXX = g++
CFLAGS = -static
CXXFLAGS = -static
LDFLAGS = -lkernelXDK

all: exploit

prerequisites:
	wget -O target_db.kxdb https://storage.googleapis.com/kernelxdk/db/kernelctf.kxdb

kaslr_bypass.o: kaslr_bypass.c kaslr_bypass.h
	$(CC) $(CFLAGS) -c kaslr_bypass.c -o kaslr_bypass.o

exploit.o: exploit.c kaslr_bypass.h
	$(CXX) $(CXXFLAGS) -c exploit.c -o exploit.o

exploit: exploit.o kaslr_bypass.o
	$(CXX) $(CXXFLAGS) -o exploit exploit.o kaslr_bypass.o $(LDFLAGS)

exploit_debug: exploit.c kaslr_bypass.c kaslr_bypass.h
	$(CC) $(CFLAGS) -g -c kaslr_bypass.c -o kaslr_bypass_dbg.o
	$(CXX) $(CXXFLAGS) -g -c exploit.c -o exploit_dbg.o
	$(CXX) $(CXXFLAGS) -g -o exploit_debug exploit_dbg.o kaslr_bypass_dbg.o $(LDFLAGS)

clean:
	rm -f exploit exploit_debug *.o