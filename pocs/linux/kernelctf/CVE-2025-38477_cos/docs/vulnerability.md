# Vulnerability

CVE-2025-38477 is a race condition vulnerability in the Linux kernel.

It occurs when 'agg' is modified in `qfq_change_agg` (called during
`qfq_enqueue`) while other threads access it concurrently. Calling different
functions concurrently build different primitives. For example, `qfq_dump_class`
may trigger a NULL dereference, and `qfq_delete_class` may cause a
use-after-free.

Easy to trigger PoC: https://lore.kernel.org/all/aGIAbGB1VAX-M8LQ@xps/

## Requirements
- **Capabilities**: `CAP_NET_ADMIN` is required.
- **Kernel configuration**: `CONFIG_NET_SCHED` and `CONFIG_NET_SCH_QFQ` must be enabled.
- **User namespaces**: Required to obtain `CAP_NET_ADMIN` if not already available to the user.

## Introduction
- **Commit**: [462dbc9101ac](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=462dbc9101ac)
- **Description**: This commit introduced the "Quick Fair Queueing Plus Scheduler" (QFQ+) to the kernel in Linux 3.0-rc1.

## Fix
- **Commit**: [5e28d5a3f774](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=5e28d5a3f774)

## Affected Versions
- Linux 3.0-rc1 to 6.16-rc6

## Subsystem
- Net scheduler
  
## Root Cause
- Race condition
