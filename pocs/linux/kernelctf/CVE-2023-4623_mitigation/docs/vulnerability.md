## Requirements to trigger the vulnerability

- CAP_NET_ADMIN in a namespace is required
- Kernel configuration:  CONFIG_NET_SCH_HFSC
- User namespaces required: Yes

## Commit which fixed the vulnerability

https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=b3d26c5702c7d6c45456326e56d2ccf3f103e60f

## Affected kernel versions

Introduced in 2.6.3. Fixed in 6.1.52 and other stable trees.

## Affected component, subsystem

net/sched: sch_hfsc

## Description

HFSC is a classful scheduler and its classes can be created with different flags affecting the scheduler behaviour.

When a packet is enqueued to a class with the HFSC_FSC (link-sharing enabled) flag, the class is inserted into the parent class tree in init_vf()/vttree_insert().
Normally, the parent also has the HFSC_FSC flag and the class is removed from the parent in the update_vf()/vttree_remove() during packet dequeue operation.
However, if the parent has no link-sharing flag it is skipped in tree traversal in update_vf() and the child class is still referenced in the parent tree.
If an attacker deletes the child class a use-after-free condition can be triggered during enqueue/dequeue operations.
