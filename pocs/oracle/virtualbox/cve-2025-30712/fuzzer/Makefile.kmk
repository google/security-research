SUB_DEPTH = ../..
include $(KBUILD_PATH)/subheader.kmk

PROGRAMS = DevVGAFuzzer
DevVGAFuzzer_Name = dev_vga_fuzzer
DevVGAFuzzer_SOURCES = main.cpp command_generator.h mock_driver.h dev_vga_fuzzer.h mock_helper.h
DevVGAFuzzer_TOOL = CLANG
DevVGAFuzzer_INCS = $(PATH_ROOT)/include
DevVGAFuzzer_INCS += $(PATH_ROOT)/include/VBox/Graphics
DevVGAFuzzer_INCS += $(PATH_ROOT)/src/VBox/Devices/Graphics
DevVGAFuzzer_INCS += $(PATH_ROOT)/src/VBox/VMM/include
DevVGAFuzzer_INCS += $(PATH_ROOT)/src/VBox/Devices/Graphics/vmsvga_include

DevVGAFuzzer_CXXFLAGS = -Wno-everything

DevVGAFuzzer_DEFS = VBOX_IN_VMM
ifdef VBOXWDDM_TEST_UHGSMI
  DevVGAFuzzer_DEFS           += VBOXWDDM_TEST_UHGSMI
 endif
 ifdef VBOXWDDM_WITH_VBVA
  DevVGAFuzzer_DEFS           += VBOXWDDM_WITH_VBVA
 endif
 ifdef VBOX_WITH_VIDEOHWACCEL
  DevVGAFuzzer_DEFS           += VBOX_WITH_VIDEOHWACCEL
 endif

 ifdef VBOX_WITH_HGSMI
  DevVGAFuzzer_DEFS           += VBOX_WITH_HGSMI
 endif

 ifdef VBOX_WITH_WDDM
  DevVGAFuzzer_DEFS           += VBOX_WITH_WDDM
 endif

 ifdef VBOX_WITH_VMSVGA
  DevVGAFuzzer_DEFS           += VBOX_WITH_VMSVGA
 endif
 ifdef VBOX_WITH_VMSVGA3D
  if1of ($(KBUILD_TARGET), linux win)
   # Dynamically load 3D library (opengl32, libGL).
   # This is a temporary solution. In future the 3D backend will be in a separate library.
   VBOX_WITH_VMSVGA3D_DYNAMIC_LOAD = 1
  endif
  DevVGAFuzzer_DEFS           += VBOX_WITH_VMSVGA3D
  ifdef VBOX_WITH_VMSVGA3D_DX
   DevVGAFuzzer_DEFS          += VMSVGA3D_DX
   if "$(KBUILD_TARGET)" == "win" || defined(VBOX_WITH_DXVK)
    DevVGAFuzzer_DEFS         += VMSVGA3D_DX_BACKEND
   endif
  endif
  if "$(KBUILD_TARGET)" == "win" && !defined(VBOX_WITH_VMSVGA3D_USE_OPENGL)
   DevVGAFuzzer_DEFS           += VMSVGA3D_DIRECT3D
  else
   DevVGAFuzzer_DEFS          += VMSVGA3D_OPENGL

   ifdef VBOX_WITH_VMSVGA3D_DYNAMIC_LOAD
    DevVGAFuzzer_DEFS         += VMSVGA3D_DYNAMIC_LOAD
   endif
   DevVGAFuzzer_DEFS.darwin    += VBOX_VMSVGA3D_DUAL_OPENGL_PROFILE
  endif
 endif

 ifdef VBOX_WITH_VDMA
  DevVGAFuzzer_DEFS           += VBOX_WITH_VDMA
 endif

 ifdef VBOX_WITH_PXE_ROM
  DevVGAFuzzer_DEFS           += VBOX_WITH_PXE_ROM
 endif


DevVGAFuzzer_LIBS = $(VBoxDD_1_TARGET)
DevVGAFuzzer_LIBS += $(VBoxVMM_1_TARGET)
DevVGAFuzzer_LIBS += $(VBoxRT_1_TARGET)
DevVGAFuzzer_LIBS += $(VBoxDDU_1_TARGET)

include $(FILE_KBUILD_SUB_FOOTER)
